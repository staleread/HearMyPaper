# План тестування стійкості системи 

## 1. Мета
Перевірити стійкість і продуктивність системи (**FastAPI + PostgreSQL + Docker**)  
під великим навантаженням, при тривалих запитах, перевищенні ресурсів та відмовах компонентів.  
Мета — виявити межі продуктивності, точки деградації та поведінку системи після перевантаження.

## 2. Об’єкти тестування
- **FastAPI backend** — стабільність ендпоінтів `/submissions` і `/pdf-to-audio` при пікових навантаженнях.  
- **PostgreSQL** — робота з великою кількістю одночасних транзакцій.  
- **Docker-середовище** — стійкість контейнерів під час перевантаження та перезапуску.  
- **Сервіс PDF → Audio (TTS)** — поведінка при паралельній конвертації великих PDF-файлів.  

## 3. Типи тестів

| № | Тип тесту | Опис сценарію | Очікуваний результат |
|---|------------|----------------|----------------------|
| 1 | **Load Test** | 50–100 одночасних запитів `POST /submissions` з PDF 1–5 МБ | Середній час відповіді ≤ 2 c, без 5xx помилок |
| 2 | **Stress Test** | Збільшення навантаження до 500 запитів/хв, поки система не деградує | Контрольована деградація (сповільнення, але без падіння) |
| 3 | **Spike Test** | Різке зростання навантаження: з 5 до 200 запитів за секунду | Система витримує сплеск, не крашиться |
| 4 | **Soak Test (Endurance)** | Постійне навантаження (20 RPS) протягом 4 годин | Відсутність витоку пам’яті, стабільний час відповіді |
| 5 | **Database Stress** | 1000 паралельних транзакцій insert/select у PostgreSQL | Відсутність deadlock’ів, стабільний час запитів |
| 6 | **Resource Saturation Test** | Обмежити ресурси контейнера (RAM 512MB, CPU 1 core) і запустити 100 запитів | Система зберігає працездатність або повертає 503 без краху |
| 7 | **File Conversion Load** | 20 паралельних запитів `/pdf-to-audio` з PDF 10–20 МБ | Усі файли конвертовано, середній час < 15 c |
| 8 | **Recovery Test** | Зупинити контейнер PostgreSQL під час навантаження і відновити | Система коректно відновлює підключення після рестарту |

## 4. Інструменти тестування
| Компонент | Інструмент / Метод |
|------------|--------------------|
| **Backend (FastAPI)** | Locust або k6 для симуляції запитів |
| **Database (PostgreSQL)** | pgbench або SQL-скрипти для паралельних транзакцій |
| **Моніторинг** | docker stats, Grafana + Prometheus, htop |
| **Аналіз логів** | docker logs, Loki або ELK Stack |
| **Сценарії тестів** | Python (httpx, asyncio) для custom stress-скриптів |

## 5. Критерії прийняття
- Під навантаженням до 80% максимальної пропускної здатності система не падає.  
- FastAPI відповідає без помилок 5xx у ≥ 99% запитів.  
- PostgreSQL не перевищує 85% CPU або RAM під час тесту.  
- Контейнери Docker автоматично відновлюються після збою.  
- Після перевантаження система стабілізується без ручного втручання.
